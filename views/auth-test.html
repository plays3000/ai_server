<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ERP í†µí•© ê°€ì… ë° ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: 'Pretendard', sans-serif; background: #f0f2f5; padding: 20px; }
        .section-title { text-align: center; color: #2c3e50; margin-bottom: 30px; }
        .common-fields { max-width: 1000px; margin: 0 auto 20px; background: white; padding: 20px; border-radius: 12px; border-top: 5px solid #2c3e50; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .grid-container { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; max-width: 1100px; margin: 0 auto; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: 1px solid #eee; }
        .card h3 { margin-top: 0; padding-bottom: 10px; border-bottom: 1px solid #eee; font-size: 1.1rem; }
        
        /* ë¡œê·¸ì¸ ì„¹ì…˜ ì „ìš© ìŠ¤íƒ€ì¼ */
        .login-section { max-width: 1000px; margin: 40px auto; background: #fff; padding: 30px; border-radius: 12px; border: 2px solid #3498db; }
        .login-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        
        .form-group { margin-bottom: 12px; }
        label { display: block; font-size: 0.85rem; font-weight: bold; margin-bottom: 5px; color: #555; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-reg { background: #2c3e50; color: white; margin-top: 10px; }
        .btn-login { background: #3498db; color: white; }
        .btn-me { background: #8e44ad; color: white; margin-top: 15px; }
        
        #result-box { max-width: 1000px; margin: 20px auto; background: #222; color: #0f0; padding: 20px; border-radius: 8px; font-family: monospace; min-height: 100px; white-space: pre-wrap; word-break: break-all; }
        .required::after { content: ' *'; color: #e74c3c; }
    </style>
</head>
<body>

    <h1 class="section-title">ğŸ›¡ï¸ ERP ì‹œìŠ¤í…œ ì¸ì¦ í†µí•© í…ŒìŠ¤íŠ¸</h1>

    <div class="common-fields">
        <h3>ğŸ‘¤ 1ë‹¨ê³„: ê°œì¸ í•„ìˆ˜ ì •ë³´ (ê³µí†µ)</h3>
        <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px;">
            <div class="form-group"><label class="required">ì•„ì´ë””</label><input type="text" id="username" placeholder="user123"></div>
            <div class="form-group"><label class="required">ì´ë©”ì¼</label><input type="email" id="email" placeholder="test@test.com"></div>
            <div class="form-group"><label class="required">ë¹„ë°€ë²ˆí˜¸</label><input type="password" id="password"></div>
            <div class="form-group"><label class="required">ì´ë¦„</label><input type="text" id="name"></div>
            <div class="form-group"><label class="required">ì „í™”ë²ˆí˜¸</label><input type="text" id="phone" placeholder="010-0000-0000"></div>
        </div>
    </div>

    <div class="grid-container">
        <div class="card">
            <h3>ğŸ¢ ê·¸ë£¹ ì°½ì„¤ (ê´€ë¦¬ì)</h3>
            <div class="form-group"><label class="required">ê·¸ë£¹ëª…</label><input type="text" id="group_name"></div>
            <div class="form-group"><label class="required">ì‚¬ì—…ìë²ˆí˜¸</label><input type="text" id="biz_num"></div>
            <button class="btn btn-reg" onclick="submitAuth('group_create')">ê·¸ë£¹ì¥ ê°€ì…</button>
        </div>

        <div class="card">
            <h3>ğŸ¢ ë²•ì¸ ì°½ì„¤ (ì¤‘ê°„ ê´€ë¦¬ì)</h3>
            <div class="form-group"><label class="required">íšŒì‚¬ëª…</label><input type="text" id="company_name"></div>
            <div class="form-group"><label>ì†Œì† ê·¸ë£¹ ì½”ë“œ</label><input type="text" id="group_code"></div>
            <button class="btn btn-reg" onclick="submitAuth('company_create')">ë²•ì¸ì¥ ê°€ì…</button>
        </div>

        <div class="card">
            <h3>ğŸ‘¥ ì¼ë°˜ ì§ì› í•©ë¥˜</h3>
            <div class="form-group"><label class="required">íšŒì‚¬ ì´ˆëŒ€ ì½”ë“œ</label><input type="text" id="invite_code"></div>
            <div class="form-group"><label>ë¶€ì„œ/ì§ê¸‰</label><input type="text" id="dept_pos" placeholder="ì¸ì‚¬íŒ€/ëŒ€ë¦¬"></div>
            <button class="btn btn-reg" onclick="submitAuth('join')">ì§ì› ê°€ì…</button>
        </div>
    </div>

    <div class="login-section">
        <div class="login-grid">
            <div>
                <h3 style="margin-top:0;">ğŸ”‘ 2ë‹¨ê³„: ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</h3>
                <div class="form-group"><label>ì´ë©”ì¼</label><input type="email" id="loginEmail"></div>
                <div class="form-group"><label>ë¹„ë°€ë²ˆí˜¸</label><input type="password" id="loginPw"></div>
                <button class="btn btn-login" onclick="handleLogin()">ë¡œê·¸ì¸í•˜ê¸°</button>
            </div>
            <div>
                <h3 style="margin-top:0;">ğŸš€ 3ë‹¨ê³„: ì„¸ì…˜ ë° ë°ì´í„° ì—°ë™ í™•ì¸</h3>
                <p style="font-size:0.85rem; color:#666;">ë¡œê·¸ì¸ ì„±ê³µ í›„ ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.</p>
                <button class="btn btn-me" onclick="checkMe()">ë‚´ ì†Œì† ì •ë³´ í™•ì¸ (/auth/me)</button>
                <a href="/" style="display:block; text-align:center; margin-top:15px; color:#3498db; text-decoration:none; font-weight:bold;">ë©”ì¸ ì±—ë´‡ í™”ë©´ìœ¼ë¡œ ì´ë™ â†’</a>
            </div>
        </div>
    </div>

    <div id="result-box">API ì‘ë‹µ ê²°ê³¼ê°€ ì—¬ê¸°ì— ì‹¤ì‹œê°„ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</div>

    <script>
        async function submitAuth(type) {
            const data = {
                username: document.getElementById('username').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value,
                type: type,
                group_name: document.getElementById('group_name').value,
                biz_num: document.getElementById('biz_num').value,
                company_name: document.getElementById('company_name').value,
                invite_code: document.getElementById('invite_code').value
            };

            const res = await fetch('/auth/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            const result = await res.json();
            document.getElementById('result-box').innerText = "[ê°€ì… ê²°ê³¼]\n" + JSON.stringify(result, null, 2);
        }

        async function handleLogin() {
            const data = {
                email: document.getElementById('loginEmail').value,
                password: document.getElementById('loginPw').value
            };

            const res = await fetch('/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            const result = await res.json();
            
            if (result.success) {
                // í† í° ì €ì¥ (í•„ìš” ì‹œ)
                if (result.token) localStorage.setItem('token', result.token);
                document.getElementById('result-box').innerText = "[ë¡œê·¸ì¸ ì„±ê³µ]\n" + JSON.stringify(result, null, 2);
            } else {
                document.getElementById('result-box').innerText = "[ë¡œê·¸ì¸ ì‹¤íŒ¨]\n" + JSON.stringify(result, null, 2);
            }
        }

        async function checkMe() {
            // ì„¸ì…˜(ì¿ í‚¤) ê¸°ë°˜ ì¸ì¦ í™•ì¸
            const res = await fetch('/auth/me');
            const result = await res.json();
            document.getElementById('result-box').innerText = "[ë‚´ ì •ë³´ í™•ì¸ ê²°ê³¼]\n" + JSON.stringify(result, null, 2);
            
            if (result.success) {
                alert(`${result.user.company_name} ì†Œì† ${result.user.name}ë‹˜ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤!`);
            }
        }
    </script>
</body>
</html>