<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 500px;
            margin: 50px auto;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            width: 100%;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
        }
        .tab.active {
            background-color: #007bff;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ë¡œê·¸ì¸ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="tabs">
        <div class="tab active" onclick="showTab('register')">íšŒì›ê°€ì…</div>
        <div class="tab" onclick="showTab('login')">ë¡œê·¸ì¸</div>
    </div>

    <!-- íšŒì›ê°€ì… í¼ -->
    <div id="register-tab" class="tab-content active">
        <h2>íšŒì›ê°€ì…</h2>
        <div class="form-group">
            <label>ì´ë¦„</label>
            <input type="text" id="reg-name" placeholder="í™ê¸¸ë™">
        </div>
        <div class="form-group">
            <label>ì´ë©”ì¼</label>
            <input type="email" id="reg-email" placeholder="test@example.com">
        </div>
        <div class="form-group">
            <label>ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" id="reg-password" placeholder="ë¹„ë°€ë²ˆí˜¸">
        </div>
        <!-- âœ… íšŒì‚¬ëª… ì…ë ¥ í•„ë“œ ì¶”ê°€ -->
        <div class="form-group">
            <label>íšŒì‚¬ëª… (ì„ íƒì‚¬í•­)</label>
            <input type="text" id="reg-company" placeholder="íšŒì‚¬ëª… (ë¹„ì›Œë‘ë©´ ê°œì¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ìƒì„±)">
            <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                ğŸ’¡ ê¸°ì¡´ íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ë©´ í•´ë‹¹ íšŒì‚¬ì˜ ì‚¬ì›ìœ¼ë¡œ ê°€ì…ë©ë‹ˆë‹¤.
            </p>
        </div>
        <button onclick="register()">íšŒì›ê°€ì…</button>
    </div>

    <!-- ë¡œê·¸ì¸ í¼ -->
    <div id="login-tab" class="tab-content">
        <h2>ë¡œê·¸ì¸</h2>
        <div class="form-group">
            <label>ì´ë©”ì¼</label>
            <input type="email" id="login-email" placeholder="test@example.com">
        </div>
        <div class="form-group">
            <label>ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" id="login-password" placeholder="ë¹„ë°€ë²ˆí˜¸">
        </div>
        <button onclick="login()">ë¡œê·¸ì¸</button>
        
        <!-- âœ… ì†Œì…œ ë¡œê·¸ì¸ ë²„íŠ¼ ì¶”ê°€ -->
        <div style="margin-top: 20px; text-align: center;">
            <p style="color: #666; margin-bottom: 10px;">ë˜ëŠ”</p>
            <button onclick="loginWithGoogle()" style="background-color: #4285F4; margin-bottom: 10px;">
                <i class="fab fa-google"></i> êµ¬ê¸€ë¡œ ë¡œê·¸ì¸
            </button>
            <button onclick="loginWithNaver()" style="background-color: #03C75A;">
                <i class="fab fa-naver"></i> ë„¤ì´ë²„ë¡œ ë¡œê·¸ì¸
            </button>
        </div>
    </div>

    <div id="result" class="result"></div>

    <script>
        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            if (tab === 'register') {
                document.querySelector('.tab:first-child').classList.add('active');
                document.getElementById('register-tab').classList.add('active');
            } else {
                document.querySelector('.tab:last-child').classList.add('active');
                document.getElementById('login-tab').classList.add('active');
            }
            
            document.getElementById('result').style.display = 'none';
        }

        // âœ… íšŒì›ê°€ì… í•¨ìˆ˜ (íšŒì‚¬ëª… í¬í•¨)
        async function register() {
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            const companyName = document.getElementById('reg-company').value;

            try {
                const response = await fetch('/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name, email, password, companyName })
                });

                const data = await response.json();
                showResult(data, response.ok);

                if (response.ok) {
                    document.getElementById('reg-name').value = '';
                    document.getElementById('reg-email').value = '';
                    document.getElementById('reg-password').value = '';
                    document.getElementById('reg-company').value = '';
                }

            } catch (error) {
                showResult({ message: 'ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ' + error.message }, false);
            }
        }

        async function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            try {
                const response = await fetch('/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                
                if (response.ok) {
                    // í† í° ì €ì¥
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    
                    // âœ… ë©”ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜
                    window.location.href = '/';
                } else {
                    showResult(data, false);
                }

            } catch (error) {
                showResult({ message: 'ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ' + error.message }, false);
            }
        }

        function loginWithGoogle() {
            window.location.href = '/auth/google';
        }

        function loginWithNaver() {
            window.location.href = '/auth/naver';
        }

        // URL íŒŒë¼ë¯¸í„°ë¡œ ë°›ì€ í† í° ì²˜ë¦¬
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            const name = urlParams.get('name');
            const error = urlParams.get('error');

            if (token) {
                localStorage.setItem('token', token);
                localStorage.setItem('userName', name);
                
                // âœ… ì ì‹œ ì„±ê³µ ë©”ì‹œì§€ ë³´ì—¬ì£¼ê³  ë¦¬ë‹¤ì´ë ‰ì…˜
                showResult({
                    message: `${name}ë‹˜, ë¡œê·¸ì¸ ì„±ê³µ! ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤...`
                }, true);
                
                setTimeout(() => {
                    window.location.href = '/';
                }, 1500);
                
            } else if (error) {
                showResult({ message: 'ì†Œì…œ ë¡œê·¸ì¸ ì‹¤íŒ¨' }, false);
            }
        });

        function showResult(data, isSuccess) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result ' + (isSuccess ? 'success' : 'error');
            resultDiv.textContent = data.message;
            resultDiv.style.display = 'block';
        }
    </script>
</body>
</html>